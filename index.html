<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Display a globe on a webpage</title>
    <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.css" rel="stylesheet">
    <script src="https://api.mapbox.com/mapbox-gl-js/v2.11.0/mapbox-gl.js"></script>
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
    </style>
</head>
<body>
<div id="map"></div>

<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoicGFsc3phYm8iLCJhIjoiY2xqYWx0bWpqMWxtZjNocW50ZjRya3k4aiJ9.v-GQX3zM-AKGgQ2736cOow';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        zoom: 4,
        center: [0, 45],
        projection: 'globe',
        attributionControl: false
    }).addControl(new mapboxgl.AttributionControl({
        customAttribution: '<a href="https://openinframap.org/">Open Infrastructure Map</a>'
    }));

    map.on('load', function () {

        map.setFog({});

        map.addSource('tileset', {
            type: 'vector',
            tiles: ['https://openinframap.org/tiles/{z}/{x}/{y}.pbf'], // Replace with your tileset URL
            tileSize: 512
        });

        map.addSource('mapbox-dem', {
            'type': 'raster-dem',
            'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
            'tileSize': 512,
            'maxzoom': 14
        });

        map.setTerrain({ 'source': 'mapbox-dem' });

        map.addLayer({
            id: 'unknownkV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1,
                'line-color': "#bd940d"
            },
            filter: ['!', ['has', 'voltage']]
        });

        // voltage boundaries below are based on: https://github.com/openinframap/openinframap/blob/369af66b7c57f8d7177b71aba4835240e723339c/web-backend/data.py#L10.
        map.addLayer({
            id: '0to10kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.125,
                'line-color': "#f084fc"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 0], ['<', ['number', ['get', 'voltage']], 10]]
        });
        map.addLayer({
            id: '10to25kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.25,
                'line-color': "#b601ce"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 10], ['<', ['number', ['get', 'voltage']], 25]]
        });
        map.addLayer({
            id: '25to52kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.375,
                'line-color': "#81ce6c"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 25], ['<', ['number', ['get', 'voltage']], 52]]
        });
        map.addLayer({
            id: '52to132kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.5,
                'line-color': "#238a05"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 52], ['<', ['number', ['get', 'voltage']], 132]]
        });
        map.addLayer({
            id: '132to220kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.625,
                'line-color': "#758ef1"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 132], ['<', ['number', ['get', 'voltage']], 220]]
        });
        map.addLayer({
            id: '220to330kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.75,
                'line-color': "#030fa1"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 220], ['<', ['number', ['get', 'voltage']], 330]]
        });
        map.addLayer({
            id: '330to550kV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 1.875,
                'line-color': "#ea0505"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 330], ['<', ['number', ['get', 'voltage']], 550]]
        });
        map.addLayer({
            id: '550andAbovekV',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-width': 2,
                'line-color':  "#940000"
            },
            filter: ['all', ['>=', ['number', ['get', 'voltage']], 550]]
        });
        map.addLayer({
            id: 'all',
            type: 'line',
            source: 'tileset',
            'source-layer': 'power_line',
            paint: {
                'line-opacity': 0,
                'line-width': 10,
                'line-color': "#000000"
            },
        });

        const popup = new mapboxgl.Popup({
            closeButton: true,
            closeOnClick: true
        });

        map.on('click', 'all', (e) => {
            map.getCanvas().style.cursor = 'pointer';

            const feature = e.features[0];

            let popupContent = '';
            for (const property in feature.properties) {
                popupContent += `<strong>${property}:</strong> ${feature.properties[property]}<br>`;
            }

            popup.setLngLat(e.lngLat).setHTML(popupContent).addTo(map);
        });

        map.addControl(new mapboxgl.FullscreenControl());

    });
</script>

</body>
</html>
